---
title: 脚手架入门
date: 2021-04-22 12:06:16
tags:
  - 基础架构
  - 脚手架
categories: 基础架构
---

# 脚手架入门

## 一、开发流程

1. 创建npm项目；

2. 创建脚手架入口文件，**最上方**添加：

   ```bash
   #!/usr/bin/env node
   ```

3. 配置package.json，添加bin属性；
4. 编写脚手架代码；
5. 将脚手架发布到npm上。

## 二、 使用流程

1. 安装

```js
npm install -g tryjane-cli
```

2. 查看

   `which tryjane-cli`： 查看包安装位置；

   ```bash
   /usr/local/bin/tryjane-cli
   ```

3. `ll /usr/local/bin/tryjane-cli`

   ```bash
   lrwxr-xr-x  1 jane  admin    44B  4 22 14:11 /usr/local/bin/tryjane-cli -> ../lib/node_modules/tryjane-cli/bin/index.js
   ```

4. 看`lib/node_modules`中的全局包关系。

   ```bash
   cd /usr/local/bin
   cd ../
   cd lib/node_modules
   ll
   ```

   ![image-20210422143758750](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210422143807.png)

5. 设置软链方式，方便调试:

   ```js
   // 当发布包tryjane-cli的本地项目根目录，执行：
   npm link
   // 在引用该项目的文件，或者本项目，执行：
   npm link tryjane-cli
   ```

![image-20210422145822199](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210422145823.png)

### 二、link使用

![image-20210422191039883](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210422191057.png)

 

## 三、注册命令

 

```js
// /tryjane-cli/bin/index.js
const lib = require('tryjane-cli-lib');
const argv = require('process').argv;
const command = argv[2];
const options = argv.slice(3);
if (options.length > 1) {
  let [option, param] = options;
  option = option.replace('--', '');
  if (command) {
    if (lib[command]) {
      lib[command]({option, param})
    } else {
      console.log('无效的命令')
    }
  } else {
    console.log('请输入命令')
  }
}

// 实现参数解析 --version 和 init --name
if(command.startsWith('--') || command.startsWith('-')) {
  const globalOption = command.replace(/--|-/g, '');
  console.log(globalOption);
  if (globalOption == 'version' || globalOption == 'V') {
    console.log('1.0.0');
  }
}

// /tryjane-cli-lib/bin/index.js
// 执行 tryjane-cli init --name vue-test
module.exports = {
  init({option, param}) {
    console.log('执行init流程', option, param)
  }
}
```

## 四、Lerna 学习

### 4.1 原生脚手架开发痛点分析

![image-20210425193238642](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210425193249.png)

### 4.2 Lerna简介

Lerna是一个优于基于 git + npm 的多package项目的管理工具。 

### 4.3 Lerna 优势

- 大幅减少重复操作；
- 提升操作的标准化；

### 4.4 案例

- Babel；
- Vue-cli；
- Create-react-app；

### 4.5 Lerna 开发脚手架流程（重点）

 ![image-20210425194001796](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210425194004.png)

![image-20210425194327620](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210425194329.png)

### 4.6 注意点

1. 在建立项目时，就先在npm上创建group，才有可能发布成功类似类型@xxx/core的包。group写xxx，不要@。

2. 想要发布类似@xxx/core这种的包，需要建立group，才能发布。

![image-20210426151229269](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210426151231.png)

3. lerna add时，使用的是文件名；lerna exec/run 时，使用的是包名；需要注意。
4. ![image-20210426160424710](https://cdn.jsdelivr.net/gh/trylang/imageManager/picgo/20210426160426.png)

4. 执行lerna命令时，使用`npx lerna publish` 类似操作。